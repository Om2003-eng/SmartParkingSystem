<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reset Password - Sayes</title>
    <style>
        body {
            margin: 0;
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #f7f9fb 0%, #e2e8f0 100%);
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding-top: 60px;
            min-height: 100vh;
        }

        @keyframes slideFadeIn {
            0% {
                opacity: 0;
                transform: translateY(-20px);
            }

            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes popIn {
            0% {
                opacity: 0;
                transform: scale(0.8);
            }

            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        .card {
            background-color: #fff;
            padding: 50px 40px 70px 40px;
            border-radius: 18px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            max-width: 500px;
            width: 90%;
            text-align: center;
            border-top: 6px solid #173C65;
            position: relative;
            animation: slideFadeIn 0.6s ease forwards;
            box-sizing: border-box;
        }

            .card img {
                width: 80px;
                margin-bottom: 20px;
            }

        h1 {
            color: #173C65;
            font-size: 28px;
            margin-bottom: 10px;
        }

        p {
            color: #506C99;
            font-size: 16px;
            margin-bottom: 30px;
        }

        label {
            display: block;
            font-size: 15px;
            font-weight: 600;
            color: #173C65;
            margin-bottom: 6px;
            margin-top: 12px;
            text-align: left;
        }

        input[type="password"] {
            width: 100%;
            padding: 14px 16px;
            margin-bottom: 14px;
            border: 1px solid #ccc;
            border-radius: 10px;
            font-size: 16px;
            outline: none;
            transition: 0.3s ease;
            box-sizing: border-box;
        }

            input[type="password"]:focus {
                border-color: #173C65;
                box-shadow: 0 0 6px rgba(23, 60, 101, 0.3);
            }

        button {
            width: 100%;
            padding: 16px 0;
            background-color: #173C65;
            color: #fff;
            font-size: 17px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            margin-top: 20px;
            transition: 0.3s ease;
        }

            button:hover:not(:disabled) {
                background-color: #D8AF17;
                color: #173C65;
            }

            button:disabled {
                opacity: 0.6;
                cursor: not-allowed;
            }

        .success, .error {
            display: none;
            font-size: 15px;
            font-weight: 600;
            margin-top: 15px;
            border-radius: 10px;
            padding: 12px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.1);
            text-align: center;
            animation: popIn 0.4s ease forwards;
        }

        .success {
            color: #173C65;
            background: #F6DD55;
        }

        .error {
            color: #fff;
            background: #E53E3E;
        }
    </style>
</head>
<body>
    <div class="card">
        <img src="https://cdn-icons-png.flaticon.com/512/3064/3064197.png" alt="Lock Icon">
        <h1>Reset Your Password</h1>
        <p>Please enter your new password below.</p>

        <label for="password">New Password</label>
        <input type="password" id="password" placeholder="Enter your new password" required />

        <label for="confirm">Confirm Password</label>
        <input type="password" id="confirm" placeholder="Re-enter your password" required />

        <button id="resetBtn" onclick="resetPassword()">Update Password</button>

        <div class="success" id="successMsg">✅ Your password has been updated successfully!</div>
        <div class="error" id="errorMsg"></div>
    </div>

    <script>
        async function resetPassword() {
            const password = document.getElementById("password").value;
            const confirm = document.getElementById("confirm").value;
            const successMsg = document.getElementById("successMsg");
            const errorMsg = document.getElementById("errorMsg");
            const btn = document.getElementById("resetBtn");
            errorMsg.style.display = "none";

            if (!password || !confirm) {
                errorMsg.textContent = "Please fill in all fields.";
                errorMsg.style.display = "block";
                return;
            }
            if (password !== confirm) {
                errorMsg.textContent = "Passwords do not match!";
                errorMsg.style.display = "block";
                return;
            }

            const urlParams = new URLSearchParams(window.location.search);
            const token = urlParams.get("token");
            const email = urlParams.get("email");

            if (!token || !email) {
                errorMsg.textContent = "Invalid reset link.";
                errorMsg.style.display = "block";
                return;
            }

            btn.disabled = true;
            btn.textContent = "Updating...";

            try {
                const response = await fetch("/api/Auth/reset-password", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ token, email, newPassword: password })
                });

                const data = await response.json();

                if (response.ok) {
                    document.querySelectorAll("input, button, label, p, img").forEach(el => el.style.display = "none");
                    successMsg.style.display = "block";
                } else {
                    errorMsg.textContent = data.message || "Something went wrong";
                    errorMsg.style.display = "block";
                    btn.disabled = false;
                    btn.textContent = "Update Password";
                }
            } catch (err) {
                errorMsg.textContent = "Network error: " + err.message;
                errorMsg.style.display = "block";
                btn.disabled = false;
                btn.textContent = "Update Password";
            }
        }
    </script>
</body>
</html>
